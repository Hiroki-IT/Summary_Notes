# 01. Malware の種類と特徴

### ◆ Malware の語源

『malicious（悪意のある）＋software（ソフトウェア）』



### ◆ Macroウイルス

Wordなどのワープロアプリや、Excelなどの表計算アプリに感染

![Macroウイルス](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/Macroウイルス.jpg)



### ◆ Worm

自己複製し、1つのコンピュータから、4つの経路（ネットワーク、メール、共有フォルダ、USB）を辿って、他のコンピュータに感染を広げていく。パソコンがグローバルIPで直接インターネットに接続していると感染しやすい。ワームを防ぐためには、パソコンにプライベートIPアドレスを設定し、NATやNAPTなどを介して、インターネットに接続させる必要がある。

**【具体例】**

共有フォルダ経由での感染拡大

![Worm（共有フォルダ）](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/Worm（共有フォルダ）.jpg)



### ◆ トロイの木馬

**【具体例】**

Google play で、過去にアプリとして忍び込んでいたトロイの木馬

![トロイの木馬](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/トロイの木馬.jpg)

感染方法がギリシャ神話上のトロイの木馬に似ていることに由来する。有用なプログラムであるように見せかけて、パソコン利用者に実行させることで感染。裏で不正な処理を行う。

※トロイの木馬はギリシャ神話に登場する。ギリシャ軍は難攻不落のトロイ城を陥落させるため、中に精鋭部隊を忍び込ませた木馬をトロイ城の近くに置いて帰った。戦利品だと勘違いしたトロイ軍は、城内に木馬を持ち帰った。夜中、木馬の中に隠れた精鋭部隊が自軍の兵士をトロイ城に引き入れ、城を制圧した。



### ◆ Spyware

パソコン利用者の個人情報を収集し、外部に送信する。

![スパイウェア](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/スパイウェア.png)



### ◆ Bot

あらかじめBot化させておいたパソコンを踏み台として、攻撃者の命令通りに動かす。

- **パソコンがボット化するまでのプロセス**

![ボット化のプロセス（パソコン）](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ボット化のプロセス（パソコン）.jpg)

- **スマホがボット化するまでのプロセス**

![ボット化のプロセス（スマホ）](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ボット化のプロセス（スマホ）.jpg)

- **Bot の使われ方**

  まず、攻撃対象のネットワーク内にあるパソコンをBot化させる。攻撃者は、Bot化したパソコンを踏み台としてサーバーを攻撃させるように、C&Cサーバーに命令を出す。

![C&Cサーバー](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/C&Cサーバー.png)



# 02-01. サイバー攻撃からの防御方法

### ◆ 防御方法の種類

![ファイアウォール_ips_ids_waf](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ファイアウォール_ips_ids_waf.png)



### ◆ ファイアウォール

![内部、DMZ、外部](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/内部、DMZ、外部.png)

- **Proxyサーバによるアプリケーションゲートウェイ型ファイアウォール**

Proxyサーバの代理リクエスト機能をファイアウォールとして用いる。Proxyサーバセキュリティ精度を重視する場合はこちら。

![フォワードプロキシサーバーとリバースプロキシサーバ](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/フォワードプロキシサーバーとリバースプロキシサーバ.png)

- **パケットフィルタリング型ファイアウォール**

  パケットのヘッダ情報に記載された送信元IPアドレスやポート番号などによって、パケットを許可するべきかどうかを決定する。速度を重視する場合はこちら。ファイアウォールとWebサーバの間には、NATルータやNAPTルータが設置されている。これらによる送信元プライベートIPアドレスから送信元グローバルIPアドレスへの変換についても参照せよ。

![パケットフィルタリング](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/パケットフィルタリング.gif)

**【具体例】**

Win10における設定画面

![パケットフィルタリングの設定](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/パケットフィルタリングの設定.gif)



### ◆ NAT：Network Address TranslationによるIPアドレスv4の変換（パケットフィルタリングに関わるので参照せよ）

- **リクエスト時のルータにおける変換**

  パケットのヘッダ情報におけるプライベートIPアドレスとグローバルIPアドレスを相互変換する機能。例えば、GoogleでWebページを見ながら、Gmailアプリを起動している場合、リクエストにおけるパケット情報として…

1. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『メールサーバの待ち受けポート番号110（POP3）』を指定して、メールサーバにリクエスト
2. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『Webサーバの待ち受けポート番号80（HTTP）』を指定して、Webサーバにリクエスト
3. 『送信元プライベートIPアドレス』『送信先グローバルIPアドレス』『DNSサーバの待ち受けポート番号53（DNS）』を指定して、DNSサーバにリクエスト
4. これらの『送信元プライベートIPアドレス』が、NATルータで、グローバルIPアドレスに変換される。

![プライベートからグローバルへのnat変換](/Users/hiroki/Documents/Drive 1st/Programming/tech-notebook/image/プライベートからグローバルへのnat変換.png)

- **レスポンス時の変換**

![グローバルからプライベートへのnat変換](/Users/hiroki/Documents/Drive 1st/Programming/tech-notebook/image/グローバルからプライベートへのnat変換.png)



### ◆ IDS：Instrusion Detection Systemとは

ネットワーク上を流れるトラフィックを監視し、不正アクセスと思われるパケットを検出した時に、管理者に通知するシステム。あくまで通知するだけで、攻撃を防御することはしない。

![IDS](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/IDS.png)



### ◆ IPS：Intrusion Prevention Systemとは

ネットワーク上を流れるトラフィックを監視し、不正アクセスと思われるパケットを検出した時に、管理者に通知し、さらにパケットの侵入を防ぐシステム。

![IPS](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/IPS.png)



### ◆ WAF：Web Application Firewallとは

Webアプリケーション自体を保護するシステム。

![WAF](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/WAF.png)



# 02-02. IPS・IDSで防御可能なサイバー攻撃

### ◆ 防御方法の種類（再掲）

![ファイアウォール_ips_ids_waf](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ファイアウォール_ips_ids_waf.png)



### ◆ DoS攻撃：Denial of Service

アクセスが集中することでWebサーバーがパンクすることを利用し、悪意を持ってWebサーバーに大量のデータを送りつける手法。

![DoS攻撃](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/DoS攻撃.png)



# 02-03. WAFで防御可能なサイバー攻撃

### ◆ 防御方法の種類（再掲）

![ファイアウォール_ips_ids_waf](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ファイアウォール_ips_ids_waf.png)



### ◆ SQL Injection

データベースのSQLクエリのパラメータとなる入力に、不正な文字列を入力して不正なSQLクエリを実行させ、データベースの情報を抜き取る手法。ただし、近年は減少傾向にある。

![SQLインジェクション](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/SQLインジェクション.jpg)

- **対策**

  データベースのSQLクエリのパラメータとなる入力では、SQLで特別な意味を持つ、『シングルクオーテーション』や『バックスラッシュ』を無効化させる。



### ◆ XSS：Cross Site Scripting

WebアプリケーションによるHTML出力のエスケープ処理の欠陥を悪用し，利用者のWebブラウザで悪意のあるスクリプトを実行させる 。

![Cross Cite Scripting](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/Cross Cite Scripting.png)



### ◆ Directory traversal

traversalは、横断する（ディレクトリの構造を乗り越える）の意味。パス名を使ってファイルを指定し，管理者の意図していないファイルを不正に閲覧またはダウンロードする。

![ディレクトリトラバーサル](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ディレクトリトラバーサル.jpg)



# 02-04. パスワードに関するサイバー攻撃

### ◆ パスワードリスト攻撃

漏洩したパスワードを用いて、正面から正々堂々とアクセスする手法。

![パスワードリスト攻撃](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/パスワードリスト攻撃.png)



### ◆ Brute-force攻撃とReverse Brute-force攻撃

Brute-forceは力ずくの意味。IDを固定して、パスワードを総当たりで試す手法。例えば、5桁数字のパスワードなら、9の5乗通りの組み合わせを試す。一方で、Reverse Brute-forceは、パスワードを固定して、IDを総当たりで試す手法。

![Brute-force攻撃とReverse Brute-force攻撃](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/Brute-force攻撃とReverse Brute-force攻撃.png)

- **パスワードのパターン数**

![パスワードのパターン数](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/パスワードのパターン数.png)



### ◆ Rainbow 攻撃

  ハッシュ化された暗号から、元のパスワードを解析する手法。

![Rainbow攻撃](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/Rainbow攻撃.png)



# 02-05. その他のサイバー攻撃

### ◆ ソーシャルエンジニアリング

技術的な手法ではなく、成りすましや詐欺によってパスワードを取得し、アクセスする手法。

![ソーシャルエンジニアリング](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ソーシャルエンジニアリング.png)



### ◆ 踏み台攻撃

対象のインターネット内のパソコンに攻撃プログラムを仕込んで置き、攻撃者からの命令でサーバを攻撃させる手法（※ボットを用いた攻撃など）

- **パソコンがボット化するまでのプロセス（再掲）**

![ボット化のプロセス（パソコン）](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ボット化のプロセス（パソコン）.jpg)

- **スマホがボット化するまでのプロセス（再掲）**

![ボット化のプロセス（スマホ）](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ボット化のプロセス（スマホ）.jpg)

- **Bot の使われ方（再掲）**

![C&Cサーバー](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/C&Cサーバー.png)



### ◆ DNS Cache Poisoning

キャッシュDNSサーバーがもつIPアドレスを偽のIPアドレスに変え、偽のWebサイトに強制的にアクセスさせる手法。

![DNSキャッシュポイズニング](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/DNSキャッシュポイズニング.gif)



### ◆ Back Door

例えば、Webサイトのカード決済画面やサーバに潜ませることによって、カード情報を第三者に送信する手法。

![バックドア](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/バックドア.png)



# 03-01. データを暗号化する目的

### ◆ 盗聴（データの盗み取り）を防ぐため

『共通鍵暗号方式』や『公開鍵暗号方式』によって実現される。暗号アルゴリズムに基づく暗号方式を用いてデータを暗号化することによって、盗聴を防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/盗聴_改竄_成りすまし_1.png)



### ◆ 改竄（データの書き換え）を防ぐため

『デジタル署名』や『ハッシュ関数』によって実現される。相手に送ったデータと相手が受け取ったデータが同じかどうかを確認することによって、改竄を防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/盗聴_改竄_成りすまし_2.png)



### ◆ 成りすましを防ぐため

『デジタル署名』によって実現される。正しい相手であることを証明することによって、成りすましを防ぐ。

![盗聴_改竄_成りすまし](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/盗聴_改竄_成りすまし_3.png)



# 03-02. 暗号アルゴリズム

データの暗号化のほとんどは、『共通鍵暗号方式』や『公開鍵暗号方式』によって実現される。それらの方式は、以下のアルゴリズムによって実装される。



### ◆ 共通鍵暗号アルゴリズム

共通鍵暗号方式を実装するためのアルゴリズム

- **DES 暗号：Data Encryption Standard**
- **AES 暗号：Advanced Encryption Standard**



### ◆ 公開鍵暗号アルゴリズム

公開鍵暗号方式を実装するためのアルゴリズム

- **RSA 暗号：Rivest-Shamir-Adleman cryptosystem**



# 03-03. 暗号アルゴリズムに基づく暗号方式

### ◆ 暗号方式の種類一覧

|                        |       共通鍵暗号方式       |     公開鍵暗号方式     |
| ---------------------- | :------------------------: | :--------------------: |
| **暗号化アルゴリズム** |   共通鍵暗号アルゴリズム   | 公開鍵暗号アルゴリズム |
| **アルゴリズムの種類** |    RC4、DES、3DES、AES     |      RSA、ElGamal      |
| **暗号化に要する時間** |          より短い          |        より長い        |
| **生成される暗号鍵**   |           共通鍵           |     秘密鍵、公開鍵     |
| **鍵の配布方法**       | メール（盗聴に気を付ける） |      メール、PKI       |
| **鍵の再利用**         |   再利用するべきではない   |    再利用してもよい    |



### ◆ 共通鍵暗号方式

サーバから受信者（クライアント）にあらかじめ秘密鍵を渡しておく。鍵の受け渡しを工夫しないと、共通鍵が盗聴される可能性がある（**鍵配送問題**）。

**【具体例】**

エクセルのファイルロック

**長所**：処理が速い

**短所**：鍵の配布が大変

![p437](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/p437.png)



### ◆ 共通鍵の再利用の可否

各受信者（クライアント）は、サーバから、受信者ごとに生成された共通鍵をもらう。鍵の再利用をするべきではない。

![共通鍵の再利用](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/共通鍵の再利用.png)



### ◆ 公開鍵暗号方式

![公開鍵暗号方式](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/公開鍵暗号方式.png)

公開鍵暗号方式でも記載の通り、共通鍵暗号方式の鍵配送問題を解決すべく開発された。『RSA暗号』などによって実装される。

**【サーバが行うこと】**

1. サーバは、受信者（クライアント）から公開鍵をもらう。
2. 公開鍵を用いて、情報を暗号化する。

**【受信者（クライアント）が行うこと】**

1. 受信者（クライアント）は、秘密鍵で情報を復号する。

- **盗聴を防ぐことができる**

  受信者（クライアント）の公開鍵で暗号化した場合、受信者の秘密鍵でのみ復号可能。すなわち、第三者に復号（解読）されることはないと判断可能。



### ◆ 公開鍵の再利用の可否

各受信者（クライアント）は、サーバから、異なるサーバで再利用される公開鍵をもらう。ただし、サーバごとに異なる秘密鍵と公開鍵を用いてもよい。

![公開鍵の再利用](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/公開鍵の再利用.png)



### ◆ ハイブリッド暗号方式

共通鍵暗号方式と公開鍵暗号方式を組み合わせた暗号方式。両方の方式の長所と短所を補う。

 ![ハイブリッド暗号](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/ハイブリッド暗号.png)



# 04-01.  暗号化方式を応用した暗号化技術

### ◆ セキュアプロトコルの種類と扱われる階層

プロトコルとしての暗号化技術である『セキュアプロトコル』は、赤色で示してある。

![セキュアプロトコル](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/セキュアプロトコル.png)



### ◆ データの作成、ヘッダ情報追加、カプセル化

パケット交換方式におけるパケットのヘッダ情報は、パソコンの各概念層のプロトコルによって追加されていく。

![パケットの構造](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/パケットの構造.jpg)



# 04-02. アプリケーション層におけるメールデータの暗号化技術

### ◆ **S/MIME：Secure MIME**

デジタル署名を含むデジタル証明書をメールに添付することによって、公開鍵の成りすましを防ぐセキュリティ技術。（デジタル証明書をS/MIMEに用いる場合、特にS/MIME証明書という。）

 ![S_MIME](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/S_MIME.png)



### ◆ 暗号ダイジェスト（デジタル署名）を用いたメールデータの暗号化

『公開鍵暗号方式とは逆の仕組み（※つまり、公開鍵暗号方式ではない）』と『ハッシュ関数』を利用した暗号化。『成りすまし』と『改竄』を防ぐことができる。

![デジタル署名](https://raw.githubusercontent.com/Hiroki-IT/tech-notebook/master/markdown/image/デジタル署名.png)

**【サーバが行うこと】**

1. サーバは、受信者（クライアント）にあらかじめ公開鍵を配布しておく。
2. 平文をハッシュ化し、ダイジェストにする。
3. ダイジェストを秘密鍵で暗号化し、暗号ダイジェスト（デジタル署名）を作成する。
4. 『平文』、『暗号ダイジェスト（デジタル署名）』を送信する。

**【受信者（クライアント）が行うこと】**

1. 受信者（クライアント）は、『平文』と『暗号ダイジェスト（デジタル署名）』を受信する。
2. 平文をハッシュ化し、ダイジェストにする。
3. 上記２つのダイジェストが同一なら、『成りすまし』と『改竄』が行われていないと判断

- **改竄を防ぐことができる**

  サーバから送られた『平文』と『暗号ダイジェスト』のどちらかが、通信の途中で改竄された場合、これらのダイジェストが同じになることは確率的にありえない。したがって、確かに改竄されていないと判断可能。

- **成りすましを防ぐことができる**

  特定の秘密鍵を持つのは、特定のサーバだけ。したがって、確かにサーバによって暗号化されたものだと判断可能。
  

**★★公開鍵の成りすましを防ぐことができない★★**

二者間だけのやり取りでは、あらかじめ受信者に渡される公開鍵が偽の送信者のものであっても、確かめる術がない。これを保障する仕組みに、PKI（公開鍵基盤）がある。



### ◆ 暗号ダイジェスト（デジタル署名）と公開鍵暗号方式を用いたメールデータの暗号化

『成りすまし』と『改竄』を防げるデジタル署名に、『盗聴』を防げる公開鍵暗号方式を組み込んだ暗号化。
