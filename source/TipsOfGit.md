# Gitの豆知識

## 01-01. Gitのトラブルシューティング

Gitの個人的豆知識を以下に記す．

### :pushpin: 基点ブランチから二回派生するブランチマージする時の注意点

1. 基点ブランチから，一つ目のブランチにマージし，これをpushする．ここでpushしないと，2番目のブランチが一つ目のブランチとの差分を検出してしまい，大量の差分コミットがgithubに表示されてしまう．
2. 一つ目のブランチから二つ目のブランチにマージし．これをpushする．
3. 

### :pushpin: Conflictの解決方法とマージコミットの作成

1. ```git status```を行い、特定のファイルでのコンフリクトが表示される。

```bash
Unmerged paths:
  (use "git restore --staged <file>..." to unstage)
  (use "git add <file>..." to mark resolution)
        both modified:   XXX/YYY.twig
```

2. コンフリクトしていたコード行を取捨選択する。

```php
/// Phpstromにて、コンフリクトしていたコード行を取捨選択する。
```

3. 一度```add```を行い、コンフリクトの修正をGitに認識させる。

```bash
$ git add XXX/YYY.twig
```

4. ```git status```を行い、以下が表示される。コンフリクトが解決されたが、マージされていないと出力される。差分のファイルがたくさん表示される場合があるが，問題ない．

```bash
All conflicts fixed but you are still merging.

Changes to be committed:
        modified:   XXX
        modified:   XXX
```

5. ```git commit```（```-m```はつけてはいけない）を行い、vimエディタが表示される。

```bash
 Merge branch 'ブランチ名' into ブランチ名
```

7. ```:wq```でエディタを終了すれば、コンフリクトを解消したマージコミットが作成される．

8. ```git status```を行う．場合によっては，差分のコミット数が表示されるが問題ない．

```bash
Your branch is ahead of 'origin/feature/XXXX' by 10 commits.

```

9. pushする．この時，マージコミットを作成する時，基点ブランチ以外からマージしていると，差分のコミットが一つにまとまらず，

参考：http://www-creators.com/archives/1938



### :pushpin: Commitの粒度

データベースからフロント出力までに至る実装をCommitする場合、以下の3つを意識する。

1. データベースからCommit
2. 関連性のある実装をまとめてCommit
3. 一回のCommitがもつコード量が少なくなるようにCommit



## 01-02. GitHubにおけるIssueとPullReqの書き方

GitHubの個人的豆知識を以下に記す．

### :pushpin: Issueの作り方

一つのIssueとブランチにたくさんの実装をCommitすることは望ましくない。そこで、大きな対応を個々の対応に分割する。そして、大きな対応に関する基点Issueと基点ブランチを作成し、個々の対応に関連する子Issueと子ブランチを作成していく。個別の対応が終わったら、親ブランチへマージしていく。

**【Issueのテンプレート例】**

```markdown
## 対応内容
〇〇する

## 目的
〇〇の問題に対処するため。

## 参考画像
キャプチャ画像など。
```



### :pushpin: PullReqの作り方

実装途中のPullReqであり，実装方法などを質問したい場合に，タイトルに『WIP』とつけておく。レビューしてもらいたくなったら、これをはずす。レビュー修正時に、実装に時間がかかりそうであったら、再び付けても良い。

**【PullReqのテンプレート例】**

```markdown
## 対応内容
〇〇するように，以下を実装いたしました。

- あ
- い
- う

## 確認手順

## 参考画像

##　レビューしていただきたいところ
〇〇すると、△△となること。
```

### :pushpin: レビューの方法

#### ・実装の条件文や，コメントから，ビジネスルールや仕様を理解．

1. 条件文で```var_dump()``` を行う．
2. どういった入力がされた場合に，```true``` として判断しているのかを確認．例えば，受注済区分値が設定されているときに，それが失注区分値に変わった場合に，値を返却しているならば，そこから，『失注』のビジネスルールが垣間見える．
3. 定数に添えられたコメントから，仕様を理解．



#### ・```empty()``` ，```isset()``` などを正しく区別して使えているかを確認．

#### ・重複する処理を```foreach()```にまとめられないかを確認．

#### ・変数の格納が重複していないかを確認．