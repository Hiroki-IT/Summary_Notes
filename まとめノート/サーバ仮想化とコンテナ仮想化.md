# 01. ホスト型仮想化

ホストOS上で、サーバを仮想的に構築する。

（Provider例）VMware Workstation、Oracle VM VirtualBox

![ホスト型仮想化](https://user-images.githubusercontent.com/42175286/60386396-3afbd080-9acf-11e9-9094-f61aa839dc04.png)



# 02. ハイパーバイザー型仮想化

BIOSから起動したハイパーバイザー上で、サーバを仮想的に構築する（※ホストOSは用いない）。

（Provider例）VMware vSphere Hypervisor、Xen、KVM

![ハイパーバイザー型仮想化](https://user-images.githubusercontent.com/42175286/60386395-3afbd080-9acf-11e9-9fbe-6287753cb43a.png)



# 03. コンテナ型仮想化

ホストOS上で、サーバではなく、コンテナを仮想的に構築する。カーネルのリソースを分割できるNamespace（PID namespace、Network namespace、UID namespace）とControl Groupsを用いて、単一のOS上に独立したコンテナを構築する。

（Provider例）Docker、LXC、OpenVZ

![コンテナ型仮想化](https://user-images.githubusercontent.com/42175286/60386394-3afbd080-9acf-11e9-96fd-321a88dbadc5.png)



# 04. 各仮想化の比較

### ◇ 起動速度の違い

ホスト型とハイパーバイザ型では、ハードウェア（CPU、メモリ、ハードディスク）とゲストOSを仮想化することが必要である。一方で、コンテナ型では、ハードウェアとゲストOSの仮想化は行わず、namespaceを用いてコンテナを構成するため、その分起動が速い。

![サーバ仮想化](https://user-images.githubusercontent.com/42175286/60386143-57e2d480-9acc-11e9-88b7-99a566346aba.png)

### ◇ 処理速度の違い

ゲストOS上のアプリを操作する場合、ホスト型とハイパーバイザ型では、ハードウェアやハイパーバイザーを経由する必要がある。この分だけ、時間（Overhead）を要する。一方で、コンテナ型では、各コンテナがホストOSとカーネルを共有するため、Overheadが小さい。

![仮想化](https://user-images.githubusercontent.com/42175286/60386143-57e2d480-9acc-11e9-88b7-99a566346aba.png)

- **Overheadの比較**

sysbenchというベンチマークツールを用いて、CPU・メモリ・ファイルI/Oに着目し、物理マシン・コンテナ型仮想化（Docker）・ホスト型仮想化（VirtualBox）のパフォーマンスを比較。

![各仮想化の比較](https://user-images.githubusercontent.com/42175286/60386476-27049e80-9ad0-11e9-92d8-76eed8927392.png)



# 05. Provider、Provisioner、Vagrantを用いた仮想環境の構築・環境設定・操作

![Vagrantの仕組み_オリジナル](https://user-images.githubusercontent.com/42175286/60393574-b18de200-9b52-11e9-803d-ef44d6e50b08.png)



- **Provider**

仮想サーバやコンテナを構築するためのアプリ。構築方法の違いによって、『ホスト型』、『ハイパーバイザ型』、『コンテナ型』に分類できる。

- **Provisioner**

仮想サーバやコンテナの環境を設定するためのアプリ。

- **Vagrant**

ProviderとProvisionerによる仮想サーバやコンテナの構築・環境設定・操作を自動化するプログラム。チームメンバーが別々に仮想サーバを構築する場合、ProviderとProvisionerの環境設定に違いが生じてしまう。Vagrantを使う場合、仮想サーバやコンテナの環境設定はVagrantfileに記述されている。また、仮想サーバやコンテナの構築・操作はvagrant経由で行える。これらのために、Vagrantを用いれば、チームメンバーが同じ環境設定の下で、仮想サーバやコンテナを構築・操作することができる。