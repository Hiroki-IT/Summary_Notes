# 勉強の方針

1. 必ず、実例として、それが扱われているのかを覚えること。
2. 必ず、言葉ではなく、イラストを用いて覚えること。
3. 必ず、知識の『点』と『点』を繋ぎ、『線』にしろ
4. 必ず、まとめることでインプットしているだけなので、口頭で説明してアプトプットしろ。
5. キタミ式で大枠をとらえて、過去問で肉付けしていく。



# 12-01. ネットワークの全体像

### ◇ インターネット、WAN、LAN

ネットワークには、『インターネット』『WAN』『LAN』がある。家庭内LAN、学内LAN、企業内LAN、企業WANなど、さまざまなネットワークがあり、インターネットは、それぞれのネットワークを互いに接続しているネットワークである。

![インターネットとWANとLAN](C:\Projects\Summary_Notes\まとめノート\画像\インターネットとWANとLAN.png)



### ◇ WAN、LANの具体例

例えば、LANとしてEthernet、WANとしてデジタル専用線を用いる。

![WAN、LANの具体例](C:\Projects\Summary_Notes\まとめノート\画像\WAN、LANの具体例.png)



### ◇ WANの種類と歴史

![WANの歴史](C:\Projects\Summary_Notes\まとめノート\画像\WANの種類と歴史.png)



### ◇ セグメント別のサーバー設置のルール

- **非武装地帯に設置するべきサーバの種類**

攻撃の影響が内部ネットワークに広がる可能性を防ぐために、外部から直接リクエストを受ける、『DNSサーバ』、『Webサーバ』、『メールサーバ』、『Proxyサーバ』は非武装地帯に設置するべき。

- **内部ネットワークに設置するべきサーバの種類**

外部からリクエストを受けないデータベースサーバは、内部ネットワークに設置するべき。

![内部、DMZ、外部](C:\Projects\Summary_Notes\まとめノート\画像\内部、DMZ、外部.png)



### ◇ 外部Webサーバとのデータ通信に要する時間

ネットワークのデータ通信には光回線が用いられている。光は、30万km／秒であり、一周4万kmの地球を7.5周／秒できることからもわかるように、遠く離れた国にあるWebサーバであっても、データ通信に要する時間は、１秒にも満たない。



### ◇ サーバの処理能力向上の方法

- **スケールアップ ⇔ スケールダウン**

  サーバ自体のスペックをより高くすることで、サーバ当たりの処理能力を向上させる。その逆は、スケールダウン。

  ![スケールアップ](C:\Projects\Summary_Notes\まとめノート\画像\スケールアップ.png)

- **スケールアウト ⇔ スケールイン**

  サーバの台数を増やすことで、サーバ全体の処理能力を向上させる。その逆は、スケールイン。

  ![スケールアウト](C:\Projects\Summary_Notes\まとめノート\画像\スケールアウト.png)

  

### ◇ ネットワークにおけるデータ通信方法の種類

- **回線交換方式**

  少数対少数でデータ通信を行うため、送信時に、送信者と受信者の宛先情報は必要ない。

  ![回線交換方式](C:\Projects\Summary_Notes\まとめノート\画像\回線交換方式.png)

- **パケット交換方式**

  通信するデータをパケット化する。多数対多数でデータ通信を行うため、送信時に、送信者と受信者の宛先情報が必要になる。

  ![パケット交換方式](C:\Projects\Summary_Notes\まとめノート\画像\パケット交換方式.png)



# 12-02. パケット作成段階におけるヘッダ情報追加

### ◇ パケットヘッダ情報追加とパソコン上での処理位置の関係

パケット交換方式におけるパケットのヘッダ情報は、パソコンの各概念層のプロトコルによって追加されていく。

![OSI参照モデルとTCPIPとヘッダ情報追加の位置.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルとTCPIPとヘッダ情報追加の位置.jpg)

### ◇ データへのヘッダ情報追加とカプセル化

![パケットの構造](C:\Projects\Summary_Notes\まとめノート\画像\パケットの構造.jpg)

### ◇ プロトコルが行っていること







# 12-03. OSI参照モデル（『アプセトネデブ』で暗記）

### ◇ 各概念層で追加されるヘッダ情報の内容

![OSI参照モデル](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデル.png)



### ◇ 各概念層の実際の通信機器の対応関係

![OSI参照モデルと通信機器.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルと通信機器.jpg)

- **ネットワーク層**

- **データリンク層**

- **物理層**

Network Interface Card（（例）LANアダプタ、LANボード、LANカード）、リピータ、LANケーブル



### ◇ 通信機器における各層のヘッダ情報の認識

送信元で作成されたパケットは、非カプセル化されながら、通信機器に認識される。

![OSI参照モデルと通信機器でのパケット認識.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルと通信機器でのパケット認識.jpg)



# 12-04. 【TCP/IP】階層モデル

### ◇ TCP/IP階層モデル

TCP/IPモデルで用いられるプロトコルのうち、最も代表的な「TCP」と「IP」から名前をとって「TCP/IP」と名付けられた。

![TCP_IPとは](C:\Projects\Summary_Notes\まとめノート\画像\TCP_IPとは.png)



# 12-05. 【TCP/IP】アプリケーション層の『HTTP』

![OSI参照モデルとTCPIPとヘッダ情報追加の位置.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルとTCPIPとヘッダ情報追加の位置.jpg)



### ◇ WebAPIの種類

HTTPの構造は、WebAPIの種類によって決まる。WebAPIには、『SOAP』と『REST』がある。

![SOAP API vs REST API](https://user-images.githubusercontent.com/42175286/59290202-fa205100-8cb2-11e9-9a16-8613a88403b4.png)



### ◇ SOAPにおけるメソッド

1999年にMicrosoft社などによって発表された。2000年前半には企業システムのWebサービス化とともに普及するかに思われたが、複雑な構造であったため次第に敬遠されるようになった。その後、簡単な構造のREST APIが好まれるようになった。

**【具体例】**POSTメソッドによるリクエスト

![SOAP API](https://user-images.githubusercontent.com/42175286/59289616-6b5f0480-8cb1-11e9-987f-b1761c73fcf1.gif)



### ◇ RESTにおけるメソッド

![HTTPリクエストのメソッド](https://user-images.githubusercontent.com/42175286/56901644-9875a000-6ad3-11e9-93a1-a738b2e382ac.png)

- **GETメソッドによるリクエスト**  
  URL以降に、『/？～』付加してHTTPリクエストを送る方法。URLに情報が記述されるため、履歴で確認できてしまう。

![GET送信時のHTTPリクエスト](https://user-images.githubusercontent.com/42175286/58061886-0ed95f80-7bb3-11e9-8998-f105a5e0ed40.png)

1. リクエスト行：常に１行
2. ヘッダー：リクエストの詳細情報
3. メソッド：GET
4. リクエストの対象:ジャンプするURLを指定
5. HTTPのバージョン
6. User-Agent：ブラウザのバージョン情報等
7. Accept：ブラウザが想定する(利用可能な)MIMEのタイプ
8. Referer：遷移元のページ
9. Accept-Encoding：ブラウザがデコードできるエンコーディング形式
10. Accept-Language：ブラウザが想定する(利用可能な)言語

- **POSTメソッドによるリクエスト**  
  メッセージボディに記述してHTTPリクエストを送る方法。メッセージボディに情報が記述されるため、履歴では確認できない。
  ![POST送信時のHTTPリクエスト](https://user-images.githubusercontent.com/42175286/58061918-29abd400-7bb3-11e9-94d0-fd528901ba7c.png)

1. リクエスト行：常に１行
2. ヘッダー：リクエストの詳細情報がある
3. 空白行：ヘッダーとボディを分ける
4. ボディ：画面での入力内容が入っている
5. メソッド：POST
6. リクエストの対象：ジャンプするURLを指定
7. HTTPのバージョン

- **レスポンス** 

![HTTPリクエストに対するHTTPレスポンス](https://user-images.githubusercontent.com/42175286/58062092-fd448780-7bb3-11e9-8b33-e11595c4e1fc.PNG)

1. ステータス行：常に１行

2. ヘッダー：レスポンスの詳細情報がある

3. 空白行：ヘッダーとボディを分ける

4. ボディ：HTMLや画像等が入る

5. HTTPのバージョン

6. ステータスコード：200はサーバーのWebシステム処理が成功したことを表す

7. Server：サーバーの名前とバージョン等です。

8. Content-Type：出力するMIMEタイプ

   

### ◇ ステータスコード

- 100番台 継続
- 200番台 リクエスト完了
- 300番台 リダイレクト（移行）
- 400番台 リクエスト失敗
- 500番台 サーバーエラー



# 12-06. 【TCP/IP】アプリケーション層の『SMTP』『POP』

![OSI参照モデルとTCPIPとヘッダ情報追加の位置.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルとTCPIPとヘッダ情報追加の位置.png.jpg)



### ◇ メール送信プロトコル

- **SMTP-AUTH**

  メール送信にあたってユーザ認証の仕組みがないSMTPを拡張し、ユーザ認証機能を追加した仕様

- **S/MIME：Secure MIME**

  公開鍵暗号技術を使用して認証、改ざん検出、暗号化などの機能を電子メールソフトに提供する



### ◇ メール受信プロトコル

- **APOP：Authenticated POP**

  メール受信の際に、チャレンジレスポンス方式の認証を行うことで平文の認証情報がネットワークに流れるのを防止するプロトコル

- **POP3：POP3 over TLS**

  TLSのセキュアな通信路上でメールソフトからメールサーバ間のPOP通信を行うプロトコル



# 12-07. 【TCP/IP】トランスポート層の『TCP』

![OSI参照モデルとTCPIPとヘッダ情報追加の位置.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルとTCPIPとヘッダ情報追加の位置.jpg)



### ◇ レスポンスにおけるポート番号の識別の仕組み

![トランスポート層からアプリケーション層へのパケットの移動](C:\Projects\Summary_Notes\まとめノート\画像\トランスポート層からアプリケーション層へのパケットの移動.PNG)

まず、プライベートIPアドレスを用いて、レスポンス先のパソコンを識別する。その後、リクエスト時のポート番号を元にして、特定のアプリにレスポンスする。

**【具体例】**Webページを見ながらメールアプリを起動している場合…

1. プロトコル『POP3』とポート番号『110』を指定して、メールアプリにレスポンス。

2. プロトコル『HTTP』とポート番号『80』を指定して、Webフロントにレスポンス。

3. プロトコル『DNS』とポート番号『53』を指定して、Webフロントにレスポンス。

   

![ポート番号](C:\Projects\Summary_Notes\まとめノート\画像\ポート番号.png)



### ◇ ポートスキャナ

ポートスキャナを用いることによって、各ポートにアクセスし、応答があるかどうかや、どのようなソフトウェアが応答するかを調べ、一覧表示することができる。



### ◇ ポート番号の種類

アプリには、種類ごとにポート番号が割り当てられている。

- **Well known ポート番号（0 ～ 1023）**

  IANA：Internet Assigned Numbers Authority（インターネット割当番号公社）によって管理されているポート番号。Webサーバがリクエストを受信する時、またレスポンスを送信する時に使用される。

  ![ポート番号とプロトコルの対応関係](C:\Projects\Summary_Notes\まとめノート\画像\ポート番号とプロトコルの対応関係.png)

- **登録済みポート番号（1024 ～ 49151）**

  IANAが登録申請を受けて公開しているポート番号。企業が作成した独自のアプリなどに対して割り当てられる。クライアントがリクエストを送信する時、またレスポンスを受信する時に使用される。

- **動的／非公式ポート番号（49152 ～ 65535）**

  自由に使用できるポート番号。クライアントがリクエストを送信する時、またレスポンスを受信する時に使用される。



# 12-08. 【TCP/IP】インターネット層の『IPv4』

![OSI参照モデルとTCPIPとヘッダ情報追加の位置.png](C:\Projects\Summary_Notes\まとめノート\画像\OSI参照モデルとTCPIPとヘッダ情報追加の位置.jpg)



### ◇ IPパケットのヘッダ情報を用いた宛先認識

1. PC-Aは、構成したIPパケットをEthernetに乗せて、ルータAに送信。
2. ルータAは、IPパケットをデジタル専用線に乗せて、ルータBに送信。
3. ルータBは、構成したIPパケットをEthernetに乗せて、Webサーバに送信。

![ネットワークにおけるTCP_IPを用いたデータ通信](C:\Projects\Summary_Notes\まとめノート\画像\ネットワークにおけるTCP_IPを用いたデータ通信.png)



### ◇ IPv4アドレスの種類

![プライベートIPアドレスとグローバルIPアドレス](C:\Projects\Summary_Notes\まとめノート\画像\プライベートIPアドレスとグローバルIPアドレス.png)

- **プライベートIPアドレス**

  LAN内で使用される。異なるプライベートネットワーク間では、同じIPv4アドレスが存在する。プライベートｆは、『10.0.0.0 ～ 10.255.255.255』、『172.16.0.0 ～ 172.31.255.255』、『192.168.0.0 ～ 192.168.255.255』で表される。

- **グローバルIPアドレス**

  プロバイダが提供するIPv4アドレス。パブリックネットワーク内に同じIPv4アドレスは存在せず、Network Information Centerへの使用申請が必要。プライベートIPアドレスの番号でなければ、グローバルIPアドレスである。

  

### ◇ IPv4アドレスのクラス

**【具体例】**128.0.0.0は、クラス B

- **クラスA**
  上位8ビット部分が、10進表記で、0～127

- **クラスB**
  上位8ビット部分が、10進表記で、128～191

- **クラスC**
  上位8ビット部分が、10進表記で、192～223

- **クラスD**
  上位8ビット部分が、10進表記で、224～239

  

### ◇ URLとメールアドレスの構造

- **各部品の名称**

![URLと電子メールの構造](C:\Projects\Summary_Notes\まとめノート\画像\URLと電子メールの構造.png)

- **各部品の様々な組み合わせ**

![ホスト名とドメイン名の組み合わせの種類](C:\Projects\Summary_Notes\まとめノート\画像\ホスト名とドメイン名の組み合わせの種類.gif)



### ◇ 完全修飾ドメイン名とグローバルIPアドレスのマッピング

![IPアドレスと完全修飾ドメイン名のマッピング1（編集後）](C:\Projects\Summary_Notes\まとめノート\画像\IPアドレスと完全修飾ドメイン名のマッピング4.png)

例えば、外部WebサーバのグローバルIPアドレスが『203.142.205.139』であると知っている場合、URLのプロトコル部分以下を『203.142.205.139』としてリクエストすれば、外部Webサーバが提供するウェブサイトにアクセスできる。しかし、グローバルIPアドレスは数字の羅列であるため、人間には覚えにくい。そこで、グローバルIPアドレスの代わりに、完全修飾ドメイン名をURLの一部として用いる。



# 12-09. 不正アクセスからの防御方法

### ◇ 不正アクセス防御方法の種類

![ファイアウォール_ips_ids_waf](C:\Projects\Summary_Notes\まとめノート\画像\ファイアウォール_ips_ids_waf.png)



### ◇ ファイアウォールの種類

- **セグメントにおけるファイアウォール（再掲）**

![内部、DMZ、外部](C:\Projects\Summary_Notes\まとめノート\画像\内部、DMZ、外部.png)

- **パケットフィルタリング型ファイアウォール**

パケットのヘッダ情報に記載された送信元IPアドレスやポート番号などによって、パケットを許可するべきかどうかを決定する。速度を重視する場合はこちら。

![パケットフィルタリング](C:\Projects\Summary_Notes\まとめノート\画像\パケットフィルタリング.gif)

**【具体例】**Win10における設定画面

![パケットフィルタリングの設定](C:\Projects\Summary_Notes\まとめノート\画像\パケットフィルタリングの設定.gif)

- **アプリケーションゲートウェイ型ファイアウォール（Proxy型）**

外部公開サーバのリバースProxyサーバを、ファイアウォールとして用いる。セキュリティ精度を重視する場合はこちら。

![フォワードプロキシサーバーとリバースプロキシサーバ](C:\Projects\Summary_Notes\まとめノート\画像\フォワードプロキシサーバーとリバースプロキシサーバ.png)



### ◇ IPS：Intrusion Detection and Protection System





### ◇ IDS：Instrusion Detection System

Dos攻撃を防ぐ。



### ◇ WAF：Web Application Firewall

スクリプト攻撃（クロスサイトスクリプティング、OSコマンドインジェクション、ディレクトリトラバーサル）を防ぐ。



# 12-10. 異なるネットワーク間でのデータ変換

### ◇ NAT：Network Address TranslationによるIPアドレスv4の変換

プライベートIPアドレスとグローバルIPアドレスを相互変換する機能。

![nat 変換](C:\Projects\Summary_Notes\まとめノート\画像\nat 変換.png)



### ◇ NAPT：Network Address Port Translationによるポート番号の変換

NATと同様にプライベートIPアドレスとグローバルIPアドレスの間を相互変換するだけでなく、ポート番号も変換する。

![napt変換](C:\Projects\Summary_Notes\まとめノート\画像\napt変換.png)



# 12-11. Proxyサーバ、DNSサーバ、Webサーバ、NAT、でのデータ通信まとめ

![ホスト名とIPアドレスの変換](C:\Projects\Summary_Notes\まとめノート\画像\IPアドレスと完全修飾ドメイン名のマッピング3.png)

1. クライアントPCは、完全修飾ドメイン名を、フォワードProxyサーバにリクエスト。

2. DNSキャッシュサーバは、完全修飾ドメイン名を、リバースProxyサーバにリクエスト。

3. リバースProxyサーバは、完全修飾ドメイン名を、DNSサーバにリクエスト。

4. DNSサーバは、完全修飾ドメインにマッピングされるIPv4アドレスを取得し、リバースProxyサーバにレスポンス。

5. リバースProxyサーバは、IPv4アドレスを、フォワードProxyサーバにレスポンス。

   （※NATによるIPv4アドレスのネットワーク間変換が起こる）

6. フォワードProxyサーバは、IPv4アドレスを、クライアントPCにレスポンス。

7. クライアントPCは、レスポンスされたIPv4アドレスを基に、Webページを、リバースProxyサーバにリクエスト。

8. リバースProxyサーバは、Webページを、Webサーバにリクエスト。

9. Webサーバは、Webページを、リバースProxyサーバにレスポンス。

10. リバースProxyサーバは、Webページを、クライアントPCにレスポンス。

※上記の様に、リクエストとレスポンスが繰り返されるが、データ通信は光速なので、１秒もかからない。